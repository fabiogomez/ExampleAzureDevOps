steps:
- checkout: WebAppRepository

- task: NodeTool@0
  inputs: 
    versionSpec: $(webAppNodeVersionForTool)
  displayName: "Set Node Version"

- task: Npm@1
  inputs:
    command: 'install'
  displayName: "Npm install"

- task: Npm@1
  inputs:
    command: 'custom'
    customCommand: 'run build --if-present'
  displayName: "Run Build"
- task: ArchiveFiles@2
  inputs:
    rootFolderOrFile: '$(System.DefaultWorkingDirectory)'
    includeRootFolder: false
    archiveFile: '$(Build.ArtifactStagingDirectory)/$(webAppZipName)'
    replaceExistingArchive: true
  displayName: "Prepare files"
  
- task: PublishBuildArtifacts@1
  inputs: 
    PathtoPublish: $(Build.ArtifactStagingDirectory) # dist or build files
    ArtifactName: '$(webAppArtifactName)'
  displayName: "Create and piblish Artifact"